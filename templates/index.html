<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Executive AI System v0.4</title>
    <link rel="stylesheet" href="/static/css/style.css?v=20260217" />
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  </head>
  <body class="v4-layout">

    <!-- ===== STICKY HEADER ===== -->
    <header class="v4-header">
      <div class="v4-logo">
        <span class="v4-logo-icon">‚öôÔ∏è</span>
        <span class="v4-logo-name">Executive AI</span>
        <span class="v4-version-badge">v0.4</span>
      </div>

      <!-- Agent status pills (click to jump to chat) -->
      <div class="v4-header-agents" id="headerAgentPills">
        <button class="v4-ha-chip v4-chip-active" data-agent="ceo" onclick="selectChatAgent('ceo')">
          <span class="v4-ha-dot v4-dot-green"></span>CEO
        </button>
        <button class="v4-ha-chip" data-agent="cfo" onclick="selectChatAgent('cfo')">
          <span class="v4-ha-dot v4-dot-amber"></span>CFO
        </button>
        <button class="v4-ha-chip" data-agent="cto" onclick="selectChatAgent('cto')">
          <span class="v4-ha-dot v4-dot-green"></span>CTO
        </button>
        <button class="v4-ha-chip" data-agent="legal" onclick="selectChatAgent('legal')">
          <span class="v4-ha-dot v4-dot-gray"></span>Legal
        </button>
        <button class="v4-ha-chip" data-agent="branding" onclick="selectChatAgent('branding')">
          <span class="v4-ha-dot v4-dot-gray"></span>Branding
        </button>
        <button class="v4-ha-chip" data-agent="web_development" onclick="selectChatAgent('web_development')">
          <span class="v4-ha-dot v4-dot-gray"></span>Web Dev
        </button>
        <button class="v4-ha-chip" data-agent="martech" onclick="selectChatAgent('martech')">
          <span class="v4-ha-dot v4-dot-gray"></span>MarTech
        </button>
      </div>

      <!-- Budget summary -->
      <div class="v4-header-budget">
        <div class="v4-hb-item">
          <span class="v4-hb-label">Total</span>
          <span class="v4-hb-val" id="totalBudget">
            {% if (scenario_defaults.budget | default(0))|float > 0 %}
              ${{ "{:,}".format((scenario_defaults.budget | default(0))|int) }}
            {% else %}-{% endif %}
          </span>
        </div>
        <div class="v4-hb-item">
          <span class="v4-hb-label">Remaining</span>
          <span class="v4-hb-val v4-val-ok" id="remainingBudget">
            {% if (scenario_defaults.budget | default(0))|float > 0 %}
              ${{ "{:,}".format((scenario_defaults.budget | default(0))|int) }}
            {% else %}-{% endif %}
          </span>
        </div>
      </div>

      <button class="v4-run-btn" id="launchOrchestration" type="button">
        üöÄ Run All Agents
      </button>
    </header>

    <!-- ===== 3-PANEL BODY ===== -->
    <div class="v4-body">

      <!-- ==================== LEFT SIDEBAR ==================== -->
      <aside class="v4-sidebar">

        <!-- Config Accordion -->
        <div class="v4-sidebar-section">
          <div class="v4-sidebar-title">Configuration</div>
          <button class="v4-cfg-toggle" id="cfgToggleBtn" onclick="toggleConfig()">
            üè¢ Company Setup <span id="cfgToggleArrow">‚ñ≤</span>
          </button>
          <div class="v4-cfg-body" id="cfgBody">
            <div class="v4-cfg-field">
              <label>Company Name</label>
              <input type="text" id="companyName"
                value="{{ scenario_defaults.company_name | default('') }}" />
            </div>
            <div class="v4-cfg-field">
              <label>DBA / Brand</label>
              <input type="text" id="dbaName"
                value="{{ scenario_defaults.dba_name | default('') }}" />
            </div>
            <div class="v4-cfg-field">
              <label>Industry</label>
              <select id="industry">
                <option value="">Select industry</option>
                <option value="Technology">Technology</option>
                <option value="Healthcare">Healthcare</option>
                <option value="Financial Services">Financial Services</option>
                <option value="Manufacturing">Manufacturing</option>
                <option value="Retail">Retail</option>
                <option value="Construction">Construction</option>
                <option value="Real Estate">Real Estate</option>
                <option value="Education">Education</option>
                <option value="Transportation &amp; Logistics">Transportation &amp; Logistics</option>
                <option value="Hospitality &amp; Tourism">Hospitality &amp; Tourism</option>
                <option value="Entertainment">Entertainment</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div class="v4-cfg-field" id="industryOtherGroup" style="display:none">
              <label>Other Industry</label>
              <input type="text" id="industryOther"
                value="{{ scenario_defaults.industry_other | default('') }}"
                placeholder="Enter your industry" />
            </div>
            <div class="v4-cfg-field">
              <label>Location</label>
              <input type="text" id="location"
                value="{{ scenario_defaults.location | default('') }}" />
            </div>
            <div class="v4-cfg-field">
              <label>Budget ($)</label>
              <input type="number" id="budget"
                value="{{ scenario_defaults.budget | default(1000) }}" min="1000" max="100000" />
            </div>
            <div class="v4-cfg-field">
              <label>Timeline (days)</label>
              <input type="number" id="timeline"
                value="{{ scenario_defaults.timeline | default(30) }}" min="30" max="365" />
            </div>
            <div class="v4-cfg-field">
              <label>Strategic Objectives</label>
              <textarea id="objectives" rows="6"
                placeholder="Enter strategic objectives (one per line)&#10;e.g., Launch new product line&#10;Expand to 3 new markets">{{ scenario_defaults.objectives_text | default('') }}</textarea>
            </div>
            <div class="v4-cfg-actions">
              <button class="btn btn-secondary btn-small" id="analyzeBtn" type="button">
                üîç Analyze
              </button>
            </div>
          </div>
        </div>

        <!-- Agent Roster -->
        <div class="v4-sidebar-section v4-roster-section">
          <div class="v4-sidebar-title">Agent Roster</div>
          <div class="v4-agent-rows">
            <div class="v4-agent-row" data-agent="cto" onclick="selectChatAgent('cto')">
              <span class="v4-ar-icon">üîß</span>
              <div class="v4-ar-info">
                <div class="v4-ar-name">CTO Agent</div>
                <div class="v4-ar-role">Architecture &amp; Tech</div>
              </div>
              <span class="v4-ar-dot v4-dot-green"></span>
            </div>
            <div class="v4-agent-row" data-agent="ceo" onclick="selectChatAgent('ceo')">
              <span class="v4-ar-icon">üëî</span>
              <div class="v4-ar-info">
                <div class="v4-ar-name">CEO Agent</div>
                <div class="v4-ar-role">Strategy &amp; Orchestration</div>
              </div>
              <span class="v4-ar-dot v4-dot-green"></span>
            </div>
            <div class="v4-agent-row" data-agent="cfo" onclick="selectChatAgent('cfo')">
              <span class="v4-ar-icon">üí∞</span>
              <div class="v4-ar-info">
                <div class="v4-ar-name">CFO Agent</div>
                <div class="v4-ar-role">Finance &amp; Analysis</div>
              </div>
              <span class="v4-ar-dot v4-dot-amber"></span>
            </div>
            <div class="v4-agent-row" data-agent="legal" onclick="selectChatAgent('legal')">
              <span class="v4-ar-icon">‚öñÔ∏è</span>
              <div class="v4-ar-info">
                <div class="v4-ar-name">Legal Agent</div>
                <div class="v4-ar-role">Ohio Compliance</div>
              </div>
              <span class="v4-ar-dot v4-dot-gray"></span>
            </div>
            <div class="v4-agent-row" data-agent="branding">
              <span class="v4-ar-icon">üé®</span>
              <div class="v4-ar-info">
                <div class="v4-ar-name">Branding Agent</div>
                <div class="v4-ar-role">Visual Identity</div>
              </div>
              <span class="v4-ar-dot v4-dot-gray"></span>
            </div>
            <div class="v4-agent-row" data-agent="web_development">
              <span class="v4-ar-icon">üíª</span>
              <div class="v4-ar-info">
                <div class="v4-ar-name">Web Dev Agent</div>
                <div class="v4-ar-role">Next.js + AR Stack</div>
              </div>
              <span class="v4-ar-dot v4-dot-gray"></span>
            </div>
            <div class="v4-agent-row" data-agent="martech">
              <span class="v4-ar-icon">üìä</span>
              <div class="v4-ar-info">
                <div class="v4-ar-name">MarTech Agent</div>
                <div class="v4-ar-role">Analytics &amp; Automation</div>
              </div>
              <span class="v4-ar-dot v4-dot-gray"></span>
            </div>
            <div class="v4-agent-row" data-agent="content">
              <span class="v4-ar-icon">üì∏</span>
              <div class="v4-ar-info">
                <div class="v4-ar-name">Content Agent</div>
                <div class="v4-ar-role">Photography &amp; Copy</div>
              </div>
              <span class="v4-ar-dot v4-dot-gray"></span>
            </div>
          </div>
        </div>

        <div class="v4-sidebar-footer">
          <div id="statusDisplay" class="v4-status-area">
            <p class="status-idle">System ready</p>
          </div>
        </div>
      </aside>

      <!-- ==================== CENTER PANEL ==================== -->
      <main class="v4-center">
        <div class="v4-center-toolbar">
          <h2 class="v4-feed-title">üì° Activity Feed</h2>
          <div class="v4-tab-pills">
            <button class="v4-tab v4-tab-active" data-tab="feed"    onclick="switchTab('feed', this)">Live</button>
            <button class="v4-tab"               data-tab="agents"  onclick="switchTab('agents', this)">Agents</button>
            <button class="v4-tab"               data-tab="reports" onclick="switchTab('reports', this)">Reports</button>
            <button class="v4-tab"               data-tab="tasks"   onclick="switchTab('tasks', this)">Tasks</button>
            <button class="v4-tab"               data-tab="log"     onclick="switchTab('log', this)">Log</button>
          </div>
        </div>

        <!-- TAB: Live Feed -->
        <div class="v4-tab-panel" id="tab-feed">
          <div id="liveFeedContainer" class="v4-feed-container">
            <div class="v4-feed-card v4-card-info">
              <div class="v4-fc-header">
                <div class="v4-fc-title">
                  ‚öôÔ∏è Executive AI System v0.4
                  <span class="v4-fc-badge v4-badge-info">Ready</span>
                </div>
                <span class="v4-fc-time">Just now</span>
              </div>
              <div class="v4-fc-meta">CTO + CEO + CFO + Legal + 4 specialist agents loaded</div>
              <p class="v4-fc-text">
                Configure your company in the sidebar, then click
                <strong>Analyze</strong> to plan or <strong>Run All Agents</strong> to execute.
                Use the chat panel to converse with any agent.
              </p>
            </div>
          </div>
        </div>

        <!-- TAB: Available Agents -->
        <div class="v4-tab-panel v4-hidden" id="tab-agents">
          <div class="v4-tab-body">
            <div id="agentsContainer" class="agents-container">
              <!-- Agents loaded dynamically by app.js -->
            </div>
          </div>
        </div>

        <!-- TAB: Reports -->
        <div class="v4-tab-panel v4-hidden" id="tab-reports">
          <div class="v4-tab-body" style="padding:1rem">
            <div id="reportDisplay" class="report-display">
              <div class="report-placeholder">
                <p>üéØ Ready to execute. Use an agent card or Run All Agents.</p>
                <p style="margin-top:1rem;opacity:.7;font-size:.9rem">
                  Reports appear here with deliverables, budget breakdown, and recommendations.
                </p>
              </div>
            </div>
            <div id="progressBar" class="progress-bar" style="display:none;margin-top:1rem">
              <div class="progress-fill" id="progressFill"></div>
              <span class="progress-text" id="progressText">0%</span>
            </div>
          </div>
        </div>

        <!-- TAB: Task Decomposition -->
        <div class="v4-tab-panel v4-hidden" id="tab-tasks">
          <div class="v4-tab-body" style="padding:1rem">
            <div id="tasksContainer" class="tasks-container">
              <p class="empty-state">Run strategic analysis to see task breakdown</p>
            </div>
          </div>
        </div>

        <!-- TAB: Execution Log -->
        <div class="v4-tab-panel v4-hidden" id="tab-log">
          <div class="v4-tab-body" style="padding:1rem">
            <div id="executionLog" class="log-container">
              <div class="log-entry">
                <span class="timestamp">[System]</span>
                <span class="message">Executive AI System v0.4 initialized and ready</span>
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- ==================== RIGHT CHAT PANEL ==================== -->
      <aside class="v4-chat-panel">

        <!-- Agent selector -->
        <div class="v4-chat-topbar">
          <div class="v4-chat-topbar-title">Talk to an Agent</div>
          <div class="v4-agent-selector" id="chatAgentSelector">
            <button class="v4-agt-btn v4-agt-active" data-agent="ceo"   onclick="selectChatAgent('ceo')">üëî CEO</button>
            <button class="v4-agt-btn"               data-agent="cfo"   onclick="selectChatAgent('cfo')">üí∞ CFO</button>
            <button class="v4-agt-btn"               data-agent="cto"   onclick="selectChatAgent('cto')">üîß CTO</button>
            <button class="v4-agt-btn"               data-agent="legal" onclick="selectChatAgent('legal')">‚öñÔ∏è Legal</button>
          </div>
        </div>

        <!-- Messages area (reuses #chatMessages so existing addChatMessage() works) -->
        <div id="chatMessages" class="v4-chat-messages chat-messages">
          <div class="chat-message system">
            <div class="chat-message-content">
              Connected ¬∑ Talking to <strong id="activeAgentLabel">CEO Agent</strong> ¬∑ LLM-backed
            </div>
            <div class="chat-message-time">Just now</div>
          </div>
        </div>

        <!-- Input bar -->
        <div class="v4-chat-input-bar">
          <div style="display:flex;gap:.5rem;width:100%">
            <input
              type="text"
              id="chatInput"
              class="v4-chat-input"
              placeholder="Ask the CEO anything‚Ä¶"
              maxlength="5000"
            />
            <button id="sendChat" class="v4-chat-send-btn" title="Send">‚ñ∂</button>
          </div>
          <button id="debateModeBtn" class="v4-debate-btn" onclick="toggleDebateMode()">
            ‚ö° Strategic Debate Mode
          </button>
        </div>
        <div class="v4-chat-status" id="chatStatus"></div>
      </aside>

    </div><!-- /.v4-body -->

    <!-- ==================== MODALS (unchanged) ==================== -->
    <div id="agentModal" class="modal">
      <div class="modal-content">
        <span class="modal-close" onclick="closeModal()">&times;</span>
        <div id="modalContent"></div>
      </div>
    </div>

    <div id="resultsModal" class="modal">
      <div class="modal-content modal-large">
        <span class="modal-close" onclick="closeResultsModal()">&times;</span>
        <div id="resultsContent"></div>
      </div>
    </div>

    <script>
      window.LEGACY_DASHBOARD_CONFIG = {
        isProduction: {{ is_production | default(false) | tojson }},
        defaults: {{ scenario_defaults | default({}) | tojson }}
      };
      // Pre-select tab from server (e.g. /?tab=reports  ‚Üí  /reports route)
      (function () {
        var tab = {{ initial_tab | default('') | tojson }};
        if (!tab) {
          var m = location.search.match(/[?&]tab=([^&]+)/);
          if (m) tab = decodeURIComponent(m[1]);
        }
        if (tab) {
          window.addEventListener('DOMContentLoaded', function () {
            var btn = document.querySelector('[data-tab="' + tab + '"]');
            if (typeof switchTab === 'function') switchTab(tab, btn);
          });
        }
      })();
    </script>
    <script src="/static/js/app.js?v=20260217"></script>
  </body>
</html>
